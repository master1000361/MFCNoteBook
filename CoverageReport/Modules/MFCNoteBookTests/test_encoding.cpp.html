<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>test_encoding.cpp</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
// test_encoding.cpp - ±àÂë×ª»»²âÊÔ
#include "pch.h"

using namespace TestableLogic;

// ============ UTF-8 ×ª Unicode ²âÊÔ ============

<span style = "background-color:#dfd">TEST(EncodingTest, UTF8ToUnicode_Empty)
{
    EXPECT_EQ(UTF8ToUnicode(""), L"");
    EXPECT_EQ(UTF8ToUnicode(nullptr), L"");
}</span>

<span style = "background-color:#dfd">TEST(EncodingTest, UTF8ToUnicode_ASCII)
{
    EXPECT_EQ(UTF8ToUnicode("Hello"), L"Hello");
}</span>

<span style = "background-color:#dfd">TEST(EncodingTest, UTF8ToUnicode_Chinese)
{</span>
    // UTF-8 ±àÂëµÄ "ÖÐÎÄ"
<span style = "background-color:#dfd">    const char* utf8 = "\xE4\xB8\xAD\xE6\x96\x87";
    std::wstring result = UTF8ToUnicode(utf8);
    EXPECT_EQ(result.length(), 2u);
    EXPECT_EQ(result[0], L'ÖÐ');
    EXPECT_EQ(result[1], L'ÎÄ');
}</span>

<span style = "background-color:#dfd">TEST(EncodingTest, UTF8ToUnicode_Mixed)
{</span>
    // "HelloÖÐÎÄ"
<span style = "background-color:#dfd">    const char* utf8 = "Hello\xE4\xB8\xAD\xE6\x96\x87";
    std::wstring result = UTF8ToUnicode(utf8);
    EXPECT_EQ(result, L"HelloÖÐÎÄ");
}</span>

// ============ Unicode ×ª UTF-8 ²âÊÔ ============

<span style = "background-color:#dfd">TEST(EncodingTest, UnicodeToUTF8_Empty)
{
    EXPECT_EQ(UnicodeToUTF8(L""), "");
    EXPECT_EQ(UnicodeToUTF8(nullptr), "");
}</span>

<span style = "background-color:#dfd">TEST(EncodingTest, UnicodeToUTF8_ASCII)
{
    EXPECT_EQ(UnicodeToUTF8(L"Hello"), "Hello");
}</span>

<span style = "background-color:#dfd">TEST(EncodingTest, UnicodeToUTF8_Chinese)
{
    std::string result = UnicodeToUTF8(L"ÖÐÎÄ");</span>
    // Ã¿¸öÖÐÎÄ×Ö·ûÔÚ UTF-8 ÖÐÕ¼ 3 ×Ö½Ú
<span style = "background-color:#dfd">    EXPECT_EQ(result.length(), 6u);
}</span>

// ============ Íù·µ×ª»»²âÊÔ ============

<span style = "background-color:#dfd">TEST(EncodingTest, RoundTrip_ASCII)
{
    const wchar_t* original = L"Hello World!";
    std::string utf8 = UnicodeToUTF8(original);
    std::wstring back = UTF8ToUnicode(utf8.c_str());
    EXPECT_EQ(back, original);
}</span>

<span style = "background-color:#dfd">TEST(EncodingTest, RoundTrip_Chinese)
{
    const wchar_t* original = L"ÖÐÎÄ²âÊÔÄÚÈÝ";
    std::string utf8 = UnicodeToUTF8(original);
    std::wstring back = UTF8ToUnicode(utf8.c_str());
    EXPECT_EQ(back, original);
}</span>

<span style = "background-color:#dfd">TEST(EncodingTest, RoundTrip_Mixed)
{
    const wchar_t* original = L"HelloÊÀ½ç123²âÊÔABC";
    std::string utf8 = UnicodeToUTF8(original);
    std::wstring back = UTF8ToUnicode(utf8.c_str());
    EXPECT_EQ(back, original);
}</span>

// ============ BOM ¼ì²â²âÊÔ ============

<span style = "background-color:#dfd">TEST(EncodingTest, DetectBOM_None)
{
    BYTE data[] = "Hello World";
    EXPECT_EQ(DetectBOM(data, sizeof(data)), 0);
}</span>

<span style = "background-color:#dfd">TEST(EncodingTest, DetectBOM_UTF8)
{
    BYTE data[] = { 0xEF, 0xBB, 0xBF, 'H', 'i' };
    EXPECT_EQ(DetectBOM(data, sizeof(data)), 1);
}</span>

<span style = "background-color:#dfd">TEST(EncodingTest, DetectBOM_UTF16LE)
{
    BYTE data[] = { 0xFF, 0xFE, 'H', 0, 'i', 0 };
    EXPECT_EQ(DetectBOM(data, sizeof(data)), 2);
}</span>

<span style = "background-color:#dfd">TEST(EncodingTest, DetectBOM_UTF16BE)
{
    BYTE data[] = { 0xFE, 0xFF, 0, 'H', 0, 'i' };
    EXPECT_EQ(DetectBOM(data, sizeof(data)), 3);
}</span>

<span style = "background-color:#dfd">TEST(EncodingTest, DetectBOM_TooShort)
{
    BYTE data[] = { 0xEF };
    EXPECT_EQ(DetectBOM(data, 1), 0);
}</span>

<span style = "background-color:#dfd">TEST(EncodingTest, DetectBOM_Null)
{
    EXPECT_EQ(DetectBOM(nullptr, 100), 0);
}</span></pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>